package com.sourav;

import org.openrewrite.ExecutionContext;
import org.openrewrite.Recipe;
import org.openrewrite.TreeVisitor;
import org.openrewrite.marker.Markers;
import org.openrewrite.quark.Quark;
import org.openrewrite.quark.QuarkVisitor;
import org.openrewrite.SourceFile;

import java.util.Set;

public class ListAllFiles extends Recipe {
    @Override
    public String getDisplayName() {
        return "List all file names";
    }

    @Override
    public String getDescription() {
        return "Prints out all file names in the repository.";
    }

    @Override
    public TreeVisitor<?, ExecutionContext> getVisitor() {
        return new QuarkVisitor<Quark>() {
            @Override
            public Quark visitQuark(Quark quark, ExecutionContext ctx) {
                Set<SourceFile> sourceFiles = getCursor().firstEnclosingOrThrow(org.openrewrite.InMemoryExecutionContext.class)
                        .getMessage("sourceFiles");
                for (SourceFile sf : sourceFiles) {
                    System.out.println(sf.getSourcePath());
                }
                return quark.withMarkers(Markers.EMPTY);
            }
        };
    }
}
